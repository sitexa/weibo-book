<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.1.1/css/bootstrap.min.css"/>
    <script src="jquery-3.3.1.min.js"></script>
    <script src="typeahead.bundle.min.js"></script>
    <script src="jq-paginator.min.js"></script>
</head>
<body>

<div style="width: 100%; max-width: 100%; margin: 0 auto;">
    <div style="width: 100%; max-width: 800px; margin: 0 auto;">
        <h1>搜索功能</h1>

        <div class="typeahead__container">
            <div class="typeahead__field">
                <span class="typeahead__query">
                    <input class="typeahead"
                        id="typeahead" name="q" type="search" autocomplete="off"
                        autofocus="autofocus" placeholder="请输入关键字"/>
                </span>
                <span class="typeahead__button">
                    <button type="button" id="btSerch" onclick="search()">
                        <span class="typeahead__search-icon"></span>
                    </button>
                </span>
            </div>
        </div>
    </div>
    <div style="background: #CDCDB4; width: 100%; height: 30px; max-width: 100%; margin: 0 auto; margin-top: 25px">
    </div>

    <div class="content" id="content">
        <div class="item">
            <h1 style="margin-left: 30px; margin-top: 10px">welcome</h1>
        </div>
    </div>
    <!--分页div默认隐藏  -->
    <div class="pageContent" hidden="hidden">
        <ul class="pagination" id="pagination1"></ul>
    </div>
</div>

<script>
      $.typeahead({
        input: '.typeahead',
        minLength: 1,
        maxItem: 20,
        order: "asc",
        dynamic: true, //不使用缓存，每次到后台查询获取
        //	href : "searchController/serchBykeyword?keyWord={{display}}", //点击item后搜索事件触发的url
        template: "{{display}}",
        emptyTemplate: 'No result for "{{query}}"',
        correlativeTemplate: true,
        source: {
          ajax: {
            type: "POST",
            url: "searchController/serch",
            path: "resList",
            data: {
              keyWord: "{{query}}"
            },
          }
        },
        callback: {
          onNavigateAfter: function (node, lis, a, item, query, event)
          {
          },
          onClickAfter: function (node, a, item, event){ //选择item的点击事件
            event.preventDefault();
            search();
          },
          onResult: function (node, query, result, resultCount)
          {
            console.log(result);
          },
          onMouseEnter: function (node, a, item, event){
            if (item.group === "country") {
              $(a).append(
                '<span class="flag-chart flag-'
                + item.display.replace(' ',
                '-').toLowerCase()
                + '"></span>')
            }
          },
          onMouseLeave: function (node, a, item, event){
            $(a).find('.flag-chart').remove();
          }
        }
      });
      //关键字搜索
      var currentPage = 0;

      function search(){
        //请求获取查询数据
        var keyWord = document.getElementById("typeahead").value;
        var pageSize = 10;

        var url = 'searchController/serchBykeyword';
        $.getJSON(url,
          {
            "keyWord": keyWord,
            "pageSize": pageSize,
            "currentPage": currentPage
          },
          function (data){
            var htmlStr = "";
            var totalHtml = '<div class="total"><a>为您找到相关结果约'
              + data.total + '个</a></div>'
            $
              .each(
                data.rows,
                function (infoIndex, info){
                  htmlStr += '<div class="item"><h4 style="margin-left: 30px; margin-top: 20px"><a href="javascript:void(0)">'
                    + info.name
                    + '</a></h4></div>'
                });
            if (data.total > 0) { //显示分页
              $(".pageContent").show();
              $('#pagination1').jqPaginator('option', { //动态修改jqPaginator属性
                currentPage: data.currentPage,
                totalCounts: data.total,
                pageSize: pageSize,
              });
            }
            $("#content").empty();//清空div元素
            $("#content").append(totalHtml + htmlStr);
          });
      }

      //回车时间监听
      $(".typeahead").keyup(function (event){
        if (event.keyCode == 13) {
          $("#btSerch").trigger("click");
        }
      });
      //初始化分页插件jqPaginator
      $('#pagination1').jqPaginator({
        totalPages: 20, //默认20
        //visiblePages : 10,
        currentPage: 1,
        onPageChange: function (num, type){
          currentPage = num;
          search();
        }
      });
    </script>

<style type="text/css">
        .tt-hint {
            color: #e9d9bb;
        }

        .tt-menu {
            border: 1px solid blue;
        }

        .tt-dataset {
            color: #004ab6;
        }

        .tt-suggestion {
            background: #aaaaaa;
        }

        .tt-cursor {
            background: gray;
        }

        .tt-highlight {
            color: red;
        }

        .item {
            background: #FFFAF0;
            width: 100%;
            height: 60px;
            max-width: 100%;
            margin: 0 auto;
            margin-top: 25px
        }

        .total {
            margin-top: 10px
        }

        .pageContent {
            margin-top: 30px;
            margin-left: 20px;
        }
    </style>

</body>
</html>
